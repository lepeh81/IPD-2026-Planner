<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Strategic Planner</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load Babel (Translator for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar for better look */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased overflow-hidden">
    <div id="root"></div>

    <!-- 3. The Application Code (ESM Module) -->
    <script type="text/babel" data-type="module">
        // Import React and libraries directly from reliable ESM CDN
        import React, { useState, useMemo, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            ZoomIn, ZoomOut, Plus, Calendar as CalendarIcon, User, 
            CheckCircle, Clock, AlertCircle, X, Trash2, Search, 
            ChevronLeft, ChevronRight, Lock, Unlock, BarChart3, 
            Paperclip, FileText, LogOut, ShieldCheck 
        } from 'https://esm.sh/lucide-react@0.292.0';

        // --- Constants & Data ---

        const MONTHS = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        const DAYS = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        const MALAYSIA_HOLIDAYS_2026 = {
            "2026-01-01": "New Year's Day",
            "2026-02-01": "Thaipusam (Est)",
            "2026-02-17": "Chinese New Year",
            "2026-02-18": "Chinese New Year Day 2",
            "2026-03-20": "Hari Raya Aidilfitri (Est)",
            "2026-03-21": "Hari Raya Aidilfitri Day 2 (Est)",
            "2026-05-01": "Labour Day",
            "2026-05-27": "Hari Raya Aidiladha (Est)",
            "2026-05-31": "Wesak Day (Est)",
            "2026-06-01": "Agong's Birthday",
            "2026-06-16": "Awal Muharram (Est)",
            "2026-08-31": "Merdeka Day",
            "2026-09-16": "Malaysia Day",
            "2026-09-24": "Prophet Muhammad's Birthday (Est)",
            "2026-11-08": "Deepavali (Est)",
            "2026-12-25": "Christmas Day"
        };

        const PIC_COLORS = {
            "Hilmy": "bg-blue-200 border-blue-400 text-blue-900",
            "Nadiah": "bg-pink-200 border-pink-400 text-pink-900",
            "Hasbalah": "bg-emerald-200 border-emerald-400 text-emerald-900",
            "Asmawi": "bg-purple-200 border-purple-400 text-purple-900",
            "Farah Idayu": "bg-yellow-200 border-yellow-400 text-yellow-900",
            "Fateha": "bg-orange-200 border-orange-400 text-orange-900",
            "Admin": "bg-gray-200 border-gray-400 text-gray-800"
        };

        const STATUS_OPTIONS = [
            { value: 'pending', label: 'Pending', color: 'text-amber-500', bg: 'bg-amber-100' },
            { value: 'started', label: 'In Progress', color: 'text-blue-500', bg: 'bg-blue-100' },
            { value: 'completed', label: 'Completed', color: 'text-emerald-500', bg: 'bg-emerald-100' },
            { value: 'blocked', label: 'Blocked', color: 'text-red-500', bg: 'bg-red-100' }
        ];

        // --- Helper Functions ---
        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
        const formatDateKey = (year, month, day) => {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        };

        // --- Main Component ---
        function PlannerApp() {
            // State
            const [currentYear] = useState(2026);
            const [currentMonth, setCurrentMonth] = useState(0); // 0 = Jan
            const [zoomLevel, setZoomLevel] = useState(1);
            const [currentUser, setCurrentUser] = useState(null);
            const isAdmin = !!currentUser;
            
            // Data
            const [tasks, setTasks] = useState([
                {
                    id: 1,
                    date: '2026-01-15',
                    title: 'Q1 Strategy Meeting',
                    pic: 'Hilmy',
                    status: 'completed',
                    description: 'Discuss roadmap for 2026.',
                    attachments: []
                },
                {
                    id: 2,
                    date: '2026-02-10',
                    title: 'Launch Campaign',
                    pic: 'Nadiah',
                    status: 'pending',
                    description: 'Social media blast.',
                    attachments: [{ name: 'campaign_brief.pdf' }]
                },
                {
                    id: 3,
                    date: '2026-02-18',
                    title: 'Site Visit KL',
                    pic: 'Hasbalah',
                    status: 'started',
                    description: 'Check new branch location.',
                    attachments: []
                }
            ]);
            
            // UI State
            const [isTaskModalOpen, setIsTaskModalOpen] = useState(false);
            const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
            const [isTeamStatsOpen, setIsTeamStatsOpen] = useState(false);
            
            const [selectedTask, setSelectedTask] = useState(null);
            const [selectedDate, setSelectedDate] = useState(null);
            
            const [filterPic, setFilterPic] = useState('All');
            const [searchQuery, setSearchQuery] = useState('');

            // Computed
            const calendarDays = useMemo(() => {
                const daysInMonth = getDaysInMonth(currentYear, currentMonth);
                const firstDay = getFirstDayOfMonth(currentYear, currentMonth);
                const days = [];

                for (let i = 0; i < firstDay; i++) {
                    days.push({ type: 'empty', key: `empty-${i}` });
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dateKey = formatDateKey(currentYear, currentMonth, i);
                    days.push({
                        type: 'day',
                        day: i,
                        dateKey: dateKey,
                        holiday: MALAYSIA_HOLIDAYS_2026[dateKey],
                        tasks: tasks.filter(t => t.date === dateKey)
                    });
                }
                return days;
            }, [currentYear, currentMonth, tasks]);

            const stats = useMemo(() => {
                const total = tasks.length;
                const completed = tasks.filter(t => t.status === 'completed').length;
                const pending = tasks.filter(t => t.status === 'pending').length;
                const inProgress = tasks.filter(t => t.status === 'started').length;
                return { total, completed, pending, inProgress };
            }, [tasks]);

            // Actions
            const handleZoom = (direction) => {
                setZoomLevel(prev => {
                    const newZoom = direction === 'in' ? prev + 0.1 : prev - 0.1;
                    return Math.min(Math.max(newZoom, 0.5), 1.5);
                });
            };

            const handleDayClick = (dateKey) => {
                if (!isAdmin) return;
                setSelectedDate(dateKey);
                setSelectedTask(null);
                setIsTaskModalOpen(true);
            };

            const handleTaskClick = (e, task) => {
                e.stopPropagation();
                setSelectedTask(task);
                setIsTaskModalOpen(true);
            };

            const saveTask = (taskData) => {
                if (selectedTask) {
                    setTasks(prev => prev.map(t => t.id === selectedTask.id ? { ...taskData, id: t.id } : t));
                } else {
                    setTasks(prev => [...prev, { ...taskData, id: Date.now(), date: selectedDate }]);
                }
                setIsTaskModalOpen(false);
            };

            const deleteTask = (id) => {
                setTasks(prev => prev.filter(t => t.id !== id));
                setIsTaskModalOpen(false);
            };

            const handleLogin = (username) => {
                setCurrentUser({
                    name: "Admin",
                    email: "admin@system",
                    avatar: `https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff&bold=true`
                });
                setIsLoginModalOpen(false);
            };

            return (
                <div className="h-screen w-full flex flex-col overflow-hidden">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 shadow-sm z-10 flex flex-col md:flex-row items-center justify-between p-4 gap-4">
                        <div className="flex items-center gap-4">
                            {isAdmin ? (
                               <div className="relative group flex items-center gap-3">
                                 <img src={currentUser.avatar} alt="Profile" className="w-10 h-10 rounded-full border-2 border-indigo-600 shadow-md" />
                                 <div>
                                    <div className="text-sm font-bold text-slate-900">Administrator</div>
                                    <div className="text-xs text-green-600 flex items-center gap-1">
                                        <span className="w-1.5 h-1.5 rounded-full bg-green-500"></span> Online
                                    </div>
                                 </div>
                               </div>
                            ) : (
                                <div className="p-2 rounded-lg shadow-lg bg-slate-500">
                                   <Lock className="text-white w-6 h-6" />
                                </div>
                            )}
                            
                            {!isAdmin && (
                                <div>
                                    <h1 className="text-xl font-bold text-slate-900 leading-tight">2026 Planner</h1>
                                    <div className="text-xs text-slate-500 uppercase tracking-wider">
                                        Read Only Mode
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Stats HUD */}
                        <div className="flex gap-4 bg-slate-100 p-2 rounded-xl">
                            <button onClick={() => setIsTeamStatsOpen(true)} className="flex flex-col items-center px-4 hover:bg-white rounded-lg transition-colors cursor-pointer group">
                                <BarChart3 className="w-5 h-5 text-indigo-600 group-hover:scale-110 transition-transform" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase mt-1">Status</span>
                            </button>
                            <div className="h-8 w-px bg-slate-300 mx-1"></div>
                            <StatPill label="Pending" value={stats.pending} color="text-amber-600 bg-amber-100" />
                            <StatPill label="Working" value={stats.inProgress} color="text-blue-600 bg-blue-100" />
                            <StatPill label="Done" value={stats.completed} color="text-emerald-600 bg-emerald-100" />
                        </div>

                        {/* Controls */}
                        <div className="flex items-center gap-2">
                            <div className="relative group hidden md:block">
                                <Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"/>
                                <input 
                                    type="text" 
                                    placeholder="Search task..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="pl-9 pr-4 py-2 bg-slate-100 border-none rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none w-48 transition-all"
                                />
                            </div>
                            
                            <div className="flex bg-slate-100 rounded-lg p-1 border border-slate-200">
                                <button onClick={() => handleZoom('out')} className="p-2 hover:bg-white hover:shadow rounded-md transition-all">
                                    <ZoomOut className="w-4 h-4 text-slate-600" />
                                </button>
                                <span className="px-2 flex items-center text-xs font-mono text-slate-500 w-12 justify-center">
                                    {Math.round(zoomLevel * 100)}%
                                </span>
                                <button onClick={() => handleZoom('in')} className="p-2 hover:bg-white hover:shadow rounded-md transition-all">
                                    <ZoomIn className="w-4 h-4 text-slate-600" />
                                </button>
                            </div>

                            {isAdmin ? (
                                <button 
                                    onClick={() => setCurrentUser(null)}
                                    className="ml-2 px-3 py-2 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg flex items-center gap-1 transition-colors"
                                >
                                    <LogOut className="w-3 h-3" /> Logout
                                </button>
                            ) : (
                                <button 
                                    onClick={() => setIsLoginModalOpen(true)}
                                    className="ml-2 px-4 py-2 text-sm font-bold text-white bg-slate-800 hover:bg-slate-900 rounded-lg shadow-lg flex items-center gap-1 transition-all"
                                >
                                    Admin Login
                                </button>
                            )}
                        </div>
                    </header>

                    {/* Navigation */}
                    <div className="bg-white border-b border-slate-200 py-3 px-6 flex items-center justify-between">
                        <button onClick={() => setCurrentMonth(m => (m === 0 ? 11 : m - 1))} className="p-2 hover:bg-slate-100 rounded-full transition-colors">
                            <ChevronLeft className="w-5 h-5" />
                        </button>
                        
                        <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-2">
                            {MONTHS[currentMonth]} <span className="text-indigo-600">{currentYear}</span>
                        </h2>

                        <button onClick={() => setCurrentMonth(m => (m === 11 ? 0 : m + 1))} className="p-2 hover:bg-slate-100 rounded-full transition-colors">
                            <ChevronRight className="w-5 h-5" />
                        </button>
                    </div>

                    {/* Board */}
                    <main className="flex-1 overflow-auto bg-slate-50 relative p-4 cursor-grab active:cursor-grabbing">
                        <div 
                            className="transition-transform duration-200 origin-top-center mx-auto shadow-2xl bg-white rounded-lg overflow-hidden border border-slate-300"
                            style={{ 
                                transform: `scale(${zoomLevel})`,
                                width: '100%',
                                maxWidth: '1400px',
                                minHeight: '800px'
                            }}
                        >
                            <div className="grid grid-cols-7 bg-slate-100 border-b border-slate-300">
                                {DAYS.map(day => (
                                    <div key={day} className="py-3 text-center text-sm font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200 last:border-r-0">
                                        {day}
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-cols-7 auto-rows-fr bg-slate-200 gap-px border-b border-slate-200">
                                {calendarDays.map((cell) => {
                                    if (cell.type === 'empty') {
                                        return <div key={cell.key} className="bg-slate-50/50 min-h-[140px]"></div>;
                                    }

                                    const isToday = new Date().toDateString() === new Date(cell.dateKey).toDateString();
                                    const isWeekend = new Date(cell.dateKey).getDay() === 0 || new Date(cell.dateKey).getDay() === 6;

                                    const visibleTasks = cell.tasks.filter(t => {
                                        const matchesSearch = t.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                                                              t.pic.toLowerCase().includes(searchQuery.toLowerCase());
                                        const matchesPic = filterPic === 'All' || t.pic === filterPic;
                                        return matchesSearch && matchesPic;
                                    });

                                    return (
                                        <div 
                                            key={cell.dateKey}
                                            onClick={() => handleDayClick(cell.dateKey)}
                                            className={`
                                                relative min-h-[160px] p-2 transition-all hover:bg-blue-50/30 group
                                                ${isWeekend ? 'bg-slate-50' : 'bg-white'}
                                                ${isToday ? 'ring-2 ring-indigo-500 ring-inset z-10' : ''}
                                                ${isAdmin ? 'cursor-pointer' : 'cursor-default'}
                                            `}
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <span className={`
                                                    text-sm font-bold w-7 h-7 flex items-center justify-center rounded-full
                                                    ${isToday ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-700'}
                                                    ${cell.holiday ? 'text-red-600' : ''}
                                                `}>
                                                    {cell.day}
                                                </span>
                                                {cell.holiday && (
                                                    <span className="text-[10px] font-bold text-red-600 bg-red-50 px-1.5 py-0.5 rounded border border-red-100 max-w-[80px] truncate leading-tight text-right">
                                                        {cell.holiday}
                                                    </span>
                                                )}
                                            </div>

                                            {isAdmin && (
                                                <button className="absolute top-2 left-10 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-slate-200 rounded-full text-slate-400">
                                                    <Plus className="w-3 h-3" />
                                                </button>
                                            )}

                                            <div className="flex flex-col gap-1.5">
                                                {visibleTasks.map(task => {
                                                    const colorClass = PIC_COLORS[task.pic] || PIC_COLORS["Admin"];
                                                    return (
                                                        <div 
                                                            key={task.id}
                                                            onClick={(e) => handleTaskClick(e, task)}
                                                            className={`
                                                                ${colorClass} p-2 rounded shadow-sm border text-xs cursor-pointer
                                                                hover:shadow-md hover:-translate-y-0.5 transition-all
                                                                relative overflow-hidden group/task
                                                            `}
                                                        >
                                                            <div className="flex items-center justify-between mb-1">
                                                                <span className="font-bold truncate">{task.pic}</span>
                                                                <div className="flex gap-1">
                                                                    {task.attachments && task.attachments.length > 0 && (
                                                                        <Paperclip className="w-3 h-3 opacity-50" />
                                                                    )}
                                                                    {task.status === 'completed' && <CheckCircle className="w-3 h-3 text-emerald-700" />}
                                                                </div>
                                                            </div>
                                                            <div className="font-medium leading-tight line-clamp-2">
                                                                {task.title}
                                                            </div>
                                                            <div className={`h-1 w-full absolute bottom-0 left-0
                                                                ${task.status === 'pending' ? 'bg-amber-400' : ''}
                                                                ${task.status === 'started' ? 'bg-blue-400' : ''}
                                                                ${task.status === 'completed' ? 'bg-emerald-400' : ''}
                                                                ${task.status === 'blocked' ? 'bg-red-400' : ''}
                                                            `}/>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </main>

                    {/* Modals */}
                    {isTaskModalOpen && <TaskModal isOpen={isTaskModalOpen} onClose={() => setIsTaskModalOpen(false)} task={selectedTask} date={selectedDate} onSave={saveTask} onDelete={deleteTask} isAdmin={isAdmin} />}
                    {isLoginModalOpen && <LoginModal isOpen={isLoginModalOpen} onClose={() => setIsLoginModalOpen(false)} onLogin={handleLogin} />}
                    {isTeamStatsOpen && <TeamStatusModal isOpen={isTeamStatsOpen} onClose={() => setIsTeamStatsOpen(false)} tasks={tasks} />}
                </div>
            );
        }

        // --- Sub-Components ---

        function StatPill({ label, value, color }) {
            return (
                <div className="flex flex-col items-center px-3 border-r border-slate-200 last:border-0 min-w-[70px]">
                    <span className={`text-sm font-bold ${color.split(' ')[0]}`}>{value}</span>
                    <span className="text-[10px] text-slate-500 font-medium uppercase">{label}</span>
                </div>
            );
        }

        function LoginModal({ isOpen, onClose, onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (username === 'admin' && password === 'admin') {
                    onLogin(username);
                } else {
                    setError('Invalid credentials. Use admin/admin');
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200">
                        <div className="p-6">
                            <div className="text-center mb-6">
                                <div className="bg-indigo-100 p-3 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                    <Lock className="w-6 h-6 text-indigo-600" />
                                </div>
                                <h3 className="text-xl font-bold text-slate-900">Admin Access</h3>
                                <p className="text-sm text-slate-500">Enter your credentials to manage tasks.</p>
                            </div>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <input type="text" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" />
                                <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" />
                                {error && <p className="text-red-500 text-xs text-center font-bold bg-red-50 p-2 rounded">{error}</p>}
                                <button type="submit" className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold shadow-lg shadow-indigo-200 transition-all">Login</button>
                            </form>
                            <button onClick={onClose} className="w-full mt-3 py-2 text-slate-400 hover:text-slate-600 text-sm">Cancel</button>
                        </div>
                    </div>
                </div>
            )
        }

        function TeamStatusModal({ isOpen, onClose, tasks }) {
            if (!isOpen) return null;
            const picList = Object.keys(PIC_COLORS).filter(p => p !== 'Admin');
            const picStats = picList.map(pic => {
                const picTasks = tasks.filter(t => t.pic === pic);
                return {
                    name: pic,
                    total: picTasks.length,
                    pending: picTasks.filter(t => t.status === 'pending').length,
                    started: picTasks.filter(t => t.status === 'started').length,
                    completed: picTasks.filter(t => t.status === 'completed').length
                };
            });

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden animate-in fade-in zoom-in duration-200 flex flex-col max-h-[90vh]">
                        <div className="bg-slate-900 text-white p-4 flex justify-between items-center">
                            <h3 className="text-lg font-bold flex items-center gap-2">Team Performance</h3>
                            <button onClick={onClose}><X className="w-5 h-5 text-slate-400 hover:text-white" /></button>
                        </div>
                        <div className="p-6 overflow-auto">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {picStats.map(stat => (
                                    <div key={stat.name} className="border border-slate-200 rounded-xl p-4 hover:shadow-lg transition-shadow bg-white">
                                        <div className="flex items-center justify-between mb-4 pb-2 border-b border-slate-100">
                                            <div className="flex items-center gap-2">
                                                <div className={`w-3 h-3 rounded-full ${PIC_COLORS[stat.name].split(' ')[0].replace('bg-', 'bg-')}`}></div>
                                                <span className="font-bold text-slate-800">{stat.name}</span>
                                            </div>
                                            <span className="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-600">Total: {stat.total}</span>
                                        </div>
                                        <div className="space-y-3">
                                            <div className="h-2 w-full bg-slate-100 rounded-full overflow-hidden flex">
                                                <div style={{ width: `${(stat.completed / (stat.total || 1)) * 100}%` }} className="bg-emerald-500 h-full"></div>
                                                <div style={{ width: `${(stat.started / (stat.total || 1)) * 100}%` }} className="bg-blue-500 h-full"></div>
                                                <div style={{ width: `${(stat.pending / (stat.total || 1)) * 100}%` }} className="bg-amber-400 h-full"></div>
                                            </div>
                                            <div className="grid grid-cols-3 gap-2 text-center text-xs">
                                                <div className="bg-amber-50 p-2 rounded text-amber-700 font-medium"><strong>{stat.pending}</strong> Pending</div>
                                                <div className="bg-blue-50 p-2 rounded text-blue-700 font-medium"><strong>{stat.started}</strong> On Going</div>
                                                <div className="bg-emerald-50 p-2 rounded text-emerald-700 font-medium"><strong>{stat.completed}</strong> Done</div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function TaskModal({ isOpen, onClose, task, date, onSave, onDelete, isAdmin }) {
            const [formData, setFormData] = useState({ title: '', pic: 'Hilmy', status: 'pending', description: '', attachments: [] });

            useEffect(() => {
                if (task) { setFormData({ ...task, attachments: task.attachments || [] }); } 
                else { setFormData({ title: '', pic: 'Hilmy', status: 'pending', description: '', attachments: [] }); }
            }, [task]);

            const handleSubmit = (e) => { e.preventDefault(); onSave(formData); };
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) { setFormData(prev => ({ ...prev, attachments: [...prev.attachments, { name: file.name, type: file.type }] })); }
            };
            const removeFile = (index) => { setFormData(prev => ({ ...prev, attachments: prev.attachments.filter((_, i) => i !== index) })); };

            if (!isOpen) return null;
            const displayDate = task ? task.date : date;
            const formattedDisplayDate = new Date(displayDate).toLocaleDateString('en-MY', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const isHoliday = MALAYSIA_HOLIDAYS_2026[displayDate];

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200 max-h-[90vh] flex flex-col">
                        <div className="bg-slate-900 text-white p-4 flex justify-between items-start shrink-0">
                            <div>
                                <h3 className="text-lg font-bold flex items-center gap-2">{isAdmin ? (task ? 'Edit Task' : 'New Task') : 'Task Details'}</h3>
                                <div className="flex items-center gap-2 text-slate-400 text-sm mt-1"><CalendarIcon className="w-3 h-3" /> {formattedDisplayDate}</div>
                                {isHoliday && <div className="inline-flex items-center gap-1 mt-2 px-2 py-0.5 rounded bg-red-500/20 text-red-200 text-xs border border-red-500/50"><AlertCircle className="w-3 h-3" /> Holiday: {isHoliday}</div>}
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X className="w-5 h-5" /></button>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 space-y-4 overflow-y-auto">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Task / Duty</label>
                                <input required disabled={!isAdmin} type="text" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-medium disabled:opacity-70 disabled:bg-slate-100" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">PIC</label>
                                    <select disabled={!isAdmin} value={formData.pic} onChange={e => setFormData({...formData, pic: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none disabled:opacity-70 disabled:bg-slate-100">
                                        {Object.keys(PIC_COLORS).map(role => <option key={role} value={role}>{role}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Status</label>
                                    <select disabled={!isAdmin} value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none disabled:opacity-70 disabled:bg-slate-100">
                                        {STATUS_OPTIONS.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Details</label>
                                <textarea disabled={!isAdmin} rows={3} value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none disabled:opacity-70 disabled:bg-slate-100"></textarea>
                            </div>
                            <div className="bg-slate-50 p-3 rounded-lg border border-slate-200">
                                <div className="flex justify-between items-center mb-2">
                                     <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Files & Resources</label>
                                     {isAdmin && <label className="cursor-pointer text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200 transition-colors flex items-center gap-1"><Plus className="w-3 h-3" /> Upload PDF <input type="file" className="hidden" onChange={handleFileUpload} /></label>}
                                </div>
                                {formData.attachments.length === 0 ? <div className="text-center py-4 text-slate-400 text-sm italic">No files attached</div> : (
                                    <div className="space-y-2">{formData.attachments.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between bg-white p-2 rounded border border-slate-200 shadow-sm">
                                            <div className="flex items-center gap-2 overflow-hidden"><div className="bg-red-100 p-1.5 rounded text-red-600"><FileText className="w-4 h-4" /></div><span className="text-sm truncate font-medium text-slate-700">{file.name}</span></div>
                                            {isAdmin && <button type="button" onClick={() => removeFile(idx)} className="text-slate-400 hover:text-red-500 p-1"><X className="w-4 h-4" /></button>}
                                        </div>
                                    ))}</div>
                                )}
                            </div>
                            {isAdmin && (
                                <div className="flex gap-3 pt-4 border-t border-slate-100 mt-4 shrink-0">
                                    {task && <button type="button" onClick={() => { if(confirm('Delete?')) onDelete(task.id); }} className="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /> Delete</button>}
                                    <div className="flex-1"></div>
                                    <button type="button" onClick={onClose} className="px-5 py-2 text-slate-600 hover:bg-slate-100 rounded-lg">Cancel</button>
                                    <button type="submit" className="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg">Save</button>
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        }

        // --- Init ---
        const root = createRoot(document.getElementById('root'));
        root.render(<PlannerApp />);
    </script>
</body>
</html>
